{"version":3,"file":"print.min.js","sources":["../src/print.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript for print event.\n *\n * @module    quiz_answersheets/print\n * @copyright 2019 The Open University\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification'], function($, Ajax, Notification) {\n\n    var t = {\n\n        /**\n         * Server side config.\n         */\n        mconfig: null,\n\n        /**\n         * CSS Selector.\n         */\n        SELECTOR: {\n            PAGE_HEADER: '.attempt-sheet-header-gecko',\n            PAGE_CONTAINER: '#page',\n            QTYPE_ORDERING_VERTICAL_SORTABLE_LIST: '.que.ordering ul.sortablelist.vertical li',\n            QTYPE_ORDERING_HORIZONTAL_SORTABLE_LIST: '.que.ordering ul.sortablelist.horizontal li',\n            QTYPE_ORDERING_MARGIN: '.orderingmargin'\n        },\n\n        /**\n         * Template.\n         */\n        TEMPLATE: {\n            QTYPE_ORDERING_MARGIN: '<div class=\"orderingmargin\"></div>',\n            QTYPE_ORDERING_WRAPPER: '<div class=\"orderingwrapper\"></div>'\n        },\n\n        /**\n         * Page header height.\n         */\n        pageHeaderHeight: 0,\n\n        /**\n         * Page container.\n         */\n        pageContainer: null,\n\n        /**\n         * Page Header element\n         */\n        pageHeader: null,\n\n\n        /**\n         * Initialise function\n         * @param {object} options Options for ajax request\n         */\n        init: function(options) {\n            t.mconfig = options;\n            t.pageHeader = $(t.SELECTOR.PAGE_HEADER);\n            t.pageContainer = $(t.SELECTOR.PAGE_CONTAINER);\n            t.pageHeaderHeight = t.pageHeader.height();\n\n            // Set the correct position for page header.\n            t.pageHeader.css('top', -Math.abs(t.pageHeaderHeight));\n            // Set the space fof page header.\n            t.pageContainer.css('margin-top', t.pageHeaderHeight);\n\n            window.addEventListener('beforeprint', t.handlePrintStart);\n            window.addEventListener('afterprint', t.handlePrintStop);\n        },\n\n        /**\n         * Handle print start event.\n         *\n         * @param {Event} e\n         */\n        handlePrintStart: function(e) {\n            e.preventDefault();\n            t.pageContainer.css('margin-top', 0);\n            if (Y.UA.gecko) {\n                t.pageContainer.css('padding-top', t.pageHeaderHeight + 30);\n                t.pageHeader.css('top', 0);\n            }\n\n            t.handlePrintForOrdering(true);\n\n            var promises = Ajax.call([{\n                methodname: 'quiz_answersheets_create_event',\n                args: {\n                    attemptid: t.mconfig.attemptid,\n                    userid: t.mconfig.userid,\n                    courseid: t.mconfig.courseid,\n                    cmid: t.mconfig.cmid,\n                    quizid: t.mconfig.quizid,\n                    pagetype: t.mconfig.pagetype\n                }\n            }]);\n            // Handle promise.\n            promises[0].then(function() {\n                return true;\n            }).fail(function(err) {\n                Notification.exception(err);\n            });\n        },\n\n        /**\n         * Handle print stop event.\n         *\n         * @param {Event} e\n         * @returns {boolean}\n         */\n        handlePrintStop: function(e) {\n            e.preventDefault();\n            t.pageContainer.css('margin-top', t.pageHeaderHeight);\n            if (Y.UA.gecko) {\n                t.pageContainer.css('padding-top', 0);\n                t.pageHeader.css('top', -Math.abs(t.pageHeaderHeight));\n            }\n            t.handlePrintForOrdering(false);\n            return true;\n        },\n\n        /**\n         * Handle print for Ordering question type.\n         *\n         * @param {boolean} isPrinting\n         */\n        handlePrintForOrdering: function(isPrinting) {\n            var sortablesVertical = $(t.SELECTOR.QTYPE_ORDERING_VERTICAL_SORTABLE_LIST);\n            var sortablesHorizontal = $(t.SELECTOR.QTYPE_ORDERING_HORIZONTAL_SORTABLE_LIST);\n            if (sortablesVertical.length || sortablesHorizontal.length) {\n                if (isPrinting) {\n                    sortablesVertical.each(function(i, nodeSortableVertical) {\n                        // We already removed all the margin and padding in the CSS.\n                        // So we need to add extra spacing here.\n                        var marginEle = $(t.TEMPLATE.QTYPE_ORDERING_MARGIN);\n                        $(nodeSortableVertical).before(marginEle);\n                        $(nodeSortableVertical).after(marginEle);\n                    });\n\n                    sortablesHorizontal.each(function(i, nodeSortableHorizontal) {\n                        // Horizontal ordering is different with vertical.\n                        // So we need to wrap the sortable with a wrapper and add extra spacing later.\n                        var marginEle = $(t.TEMPLATE.QTYPE_ORDERING_MARGIN);\n                        marginEle.addClass('horizontal');\n                        $(nodeSortableHorizontal).after(marginEle);\n                        $(nodeSortableHorizontal).wrap(t.TEMPLATE.QTYPE_ORDERING_WRAPPER);\n                    });\n                } else {\n                    // Remove all the margin placeholder.\n                    $(t.SELECTOR.QTYPE_ORDERING_MARGIN).remove();\n                    if (sortablesHorizontal.length) {\n                        sortablesHorizontal.each(function(i, nodeSortableHorizontal) {\n                            // Remove the wrapper for horizontal sortable.\n                            $(nodeSortableHorizontal).unwrap();\n                        });\n                    }\n                }\n            }\n        }\n\n    };\n\n    return t;\n});\n"],"names":["define","$","Ajax","Notification","t","mconfig","SELECTOR","PAGE_HEADER","PAGE_CONTAINER","QTYPE_ORDERING_VERTICAL_SORTABLE_LIST","QTYPE_ORDERING_HORIZONTAL_SORTABLE_LIST","QTYPE_ORDERING_MARGIN","TEMPLATE","QTYPE_ORDERING_WRAPPER","pageHeaderHeight","pageContainer","pageHeader","init","options","height","css","Math","abs","window","addEventListener","handlePrintStart","handlePrintStop","e","preventDefault","Y","UA","gecko","handlePrintForOrdering","call","methodname","args","attemptid","userid","courseid","cmid","quizid","pagetype","then","fail","err","exception","isPrinting","sortablesVertical","sortablesHorizontal","length","each","i","nodeSortableVertical","marginEle","before","after","nodeSortableHorizontal","addClass","wrap","remove","unwrap"],"mappings":";;;;;;;AAuBAA,iCAAO,CAAC,SAAU,YAAa,sBAAsB,SAASC,EAAGC,KAAMC,kBAE/DC,EAAI,CAKJC,QAAS,KAKTC,SAAU,CACNC,YAAa,8BACbC,eAAgB,QAChBC,sCAAuC,4CACvCC,wCAAyC,8CACzCC,sBAAuB,mBAM3BC,SAAU,CACND,sBAAuB,qCACvBE,uBAAwB,uCAM5BC,iBAAkB,EAKlBC,cAAe,KAKfC,WAAY,KAOZC,KAAM,SAASC,SACXd,EAAEC,QAAUa,QACZd,EAAEY,WAAaf,EAAEG,EAAEE,SAASC,aAC5BH,EAAEW,cAAgBd,EAAEG,EAAEE,SAASE,gBAC/BJ,EAAEU,iBAAmBV,EAAEY,WAAWG,SAGlCf,EAAEY,WAAWI,IAAI,OAAQC,KAAKC,IAAIlB,EAAEU,mBAEpCV,EAAEW,cAAcK,IAAI,aAAchB,EAAEU,kBAEpCS,OAAOC,iBAAiB,cAAepB,EAAEqB,kBACzCF,OAAOC,iBAAiB,aAAcpB,EAAEsB,kBAQ5CD,iBAAkB,SAASE,GACvBA,EAAEC,iBACFxB,EAAEW,cAAcK,IAAI,aAAc,GAC9BS,EAAEC,GAAGC,QACL3B,EAAEW,cAAcK,IAAI,cAAehB,EAAEU,iBAAmB,IACxDV,EAAEY,WAAWI,IAAI,MAAO,IAG5BhB,EAAE4B,wBAAuB,GAEV9B,KAAK+B,KAAK,CAAC,CACtBC,WAAY,iCACZC,KAAM,CACFC,UAAWhC,EAAEC,QAAQ+B,UACrBC,OAAQjC,EAAEC,QAAQgC,OAClBC,SAAUlC,EAAEC,QAAQiC,SACpBC,KAAMnC,EAAEC,QAAQkC,KAChBC,OAAQpC,EAAEC,QAAQmC,OAClBC,SAAUrC,EAAEC,QAAQoC,aAInB,GAAGC,MAAK,kBACN,KACRC,MAAK,SAASC,KACbzC,aAAa0C,UAAUD,SAU/BlB,gBAAiB,SAASC,UACtBA,EAAEC,iBACFxB,EAAEW,cAAcK,IAAI,aAAchB,EAAEU,kBAChCe,EAAEC,GAAGC,QACL3B,EAAEW,cAAcK,IAAI,cAAe,GACnChB,EAAEY,WAAWI,IAAI,OAAQC,KAAKC,IAAIlB,EAAEU,oBAExCV,EAAE4B,wBAAuB,IAClB,GAQXA,uBAAwB,SAASc,gBACzBC,kBAAoB9C,EAAEG,EAAEE,SAASG,uCACjCuC,oBAAsB/C,EAAEG,EAAEE,SAASI,0CACnCqC,kBAAkBE,QAAUD,oBAAoBC,UAC5CH,YACAC,kBAAkBG,MAAK,SAASC,EAAGC,0BAG3BC,UAAYpD,EAAEG,EAAEQ,SAASD,uBAC7BV,EAAEmD,sBAAsBE,OAAOD,WAC/BpD,EAAEmD,sBAAsBG,MAAMF,cAGlCL,oBAAoBE,MAAK,SAASC,EAAGK,4BAG7BH,UAAYpD,EAAEG,EAAEQ,SAASD,uBAC7B0C,UAAUI,SAAS,cACnBxD,EAAEuD,wBAAwBD,MAAMF,WAChCpD,EAAEuD,wBAAwBE,KAAKtD,EAAEQ,SAASC,6BAI9CZ,EAAEG,EAAEE,SAASK,uBAAuBgD,SAChCX,oBAAoBC,QACpBD,oBAAoBE,MAAK,SAASC,EAAGK,wBAEjCvD,EAAEuD,wBAAwBI,uBAS3CxD"}